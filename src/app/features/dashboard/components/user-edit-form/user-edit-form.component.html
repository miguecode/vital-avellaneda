<form [formGroup]="form" (ngSubmit)="onSubmit()">
  <div class="flex flex-wrap gap-4">

    <!-- Profile Picture Selector Input -->
    <div class="w-full flex sm:justify-start justify-center items-center rounded-3xl
      py-3 sm:px-8 px-4">
      <label
        for="profilePictureInput" 
        class="cursor-pointer flex sm:flex-row flex-col justify-center items-center gap-x-6 gap-y-0 group">
        <div class="relative">
          <img 
          [src]="profilePictureUrl()"
          alt="Profile Picture"
          class="sm:h-22 h-18 sm:min-w-22 min-w-18 object-cover rounded-lg outline-2 outline-va-fifth">
          <div class="absolute size-9 flex justify-center items-center
          rounded-lg bg-va-primary z-2 -top-2 -right-4 hover:bg-va-third transition-colors">
            <app-svg-icon icon="edit" class="text-va-secondary"></app-svg-icon>
          </div>
        </div>

        <div
          class="flex justify-center items-center text-va-primary w-full
          font-medium text-lg py-3">
          <div class="flex flex-col">
            <div class="flex xs:flex-row flex-col">
              <span class="pl-1 group-hover:underline text-center">Elegir foto de perfil</span>
              <span class="text-va-fifth/90 pl-1.5 text-center">(Opcional)</span>
            </div>
            <p
              class="sm:block hidden text-sm font-normal pl-1.5 pt-0.5 text-pretty">
              Se recomienda seleccionar una foto a modo de retrato y con buena iluminación.
            </p>
            <p class="sm:block hidden text-sm font-normal pl-1.5 text-pretty">
              Elegir una foto no es obligatorio: La idea es hacer más humano el manejo de Vital Avellaneda.
            </p>
          </div>
        </div>

      </label>
      <input
        id="profilePictureInput"
        type="file"
        class="hidden"
        (change)="onFileSelected($event)"
        accept="image/*"
      >
    </div>



    <!-- First Column -->
    <div
      [class.hidden]="showSpecialtyModal()"
      class="flex flex-col gap-8 p-2 w-full md:w-input-group min-w-64">
      <app-input-custom
        type="text"
        formControlName="firstName"
        name="firstName"
        label="Nombre"
        placeholder="Nombre (2-30 caracteres)"
        autocomplete="given-name"
        [minlength]="2"
        [maxlength]="30"
      />
      <app-input-custom
        type="text"
        formControlName="lastName"
        name="lastName"
        label="Apellido"
        placeholder="Apellido (2-30 caracteres)"
        autocomplete="family-name"
        [minlength]="2"
        [maxlength]="30"
      />
    </div>

    <!-- Second Column -->
    <div 
      [class.hidden]="showSpecialtyModal()"
      class="flex flex-col gap-8 p-2 w-full md:w-input-group min-w-64">
      <app-select-custom
        formControlName="sex"
        label="Sexo"
        name="sex"
        placeholder="Seleccionar..."
        [required]="true"
        [options]="sexOptions"
        [labelMap]="sexLabels"
        [showValue]="true"
      />
      <app-input-custom
        type="text"
        formControlName="phone"
        name="phone"
        label="Número de Teléfono (opcional)"
        placeholder="Número (8-15 dígitos)"
        autocomplete="tel"
        [minlength]="8"
        [maxlength]="15"
      />
    </div>

    <!-- Third Column -->
    <div 
      [class.hidden]="showSpecialtyModal()"
      class="flex flex-col gap-8 p-2 w-full md:w-input-group min-w-64">
      @if (!isSpecialist()) {
        <app-select-custom
          formControlName="healthInsurance"
          label="Obra Social"
          [options]="healthInsuranceOptions"
          [labelMap]="healthInsuranceLabels"
          [showValue]="true"
        ></app-select-custom>
      }
      @else {
        <div class="w-full">
          <label for="specialtiesButton" class="text-va-primary font-medium">Especialidades</label>
          <button
            id="specialtiesButton"
            type="button"
            (click)="openModal()"
            class="cursor-pointer w-full h-select-height pt-0.5 pl-3 text-start
             text-black rounded bg-white border border-va-third hover:bg-amber-50
              active:bg-amber-100 transition-all duration-300 shadow
              disabled:opacity-50 disabled:cursor-not-allowed"
          >
            Seleccionar ({{ form.get('specialties')?.value.length }} seleccionadas)
          </button>
        </div>
      }
    </div>

    <!-- Specialty Selector Modal -->
    @if (showSpecialtyModal()) {
      <app-specialty-selector
        [lastSelected]="form.get('specialties')?.value"
        (confirm)="onSpecialtiesSelected($event)"
        (cancel)="closeModal()"
        class="z-20 max-w-6xl
         bg-white border border-va-third/20 shadow rounded"
      />
    }
  </div>

  <!-- Footer -->
  <div class="md:mt-8 mt-4 flex flex-col flex-wrap
  justify-center items-center h-full gap-3">
    <!-- Submit Button -->
      <button
        type="submit"
        [class.hidden]="showSpecialtyModal()"
        [disabled]="form.invalid || !hasChanges() ||  isLoading()"
        class="cursor-pointer px-8 py-3 text-white text-lg rounded-lg font-medium
              bg-va-primary hover:bg-va-third active:bg-va-third/90
              transition duration-300 shadow-md md:w-auto w-full
              disabled:bg-va-primary/50 disabled:shadow-none disabled:cursor-auto
              flex items-center justify-center gap-2"
      >
        @if (isLoading()) {
          <div 
          class="animate-spin inline-block size-6 border-3
                      border-current border-t-transparent text-white rounded-full"
              role="status" aria-label="loading"></div>
          Guardando...
        } @else {
          Guardar cambios
        }
      </button>

      <!-- Advice -->
      <div 
      [class.hidden]="showSpecialtyModal()"
      class="flex justify-start items-start text-sm md:max-w-164 
       gap-2 bg-amber-200 border-2 border-amber-300 text-black rounded p-3 mt-3">
          <app-svg-icon class="h-full text-amber-900" icon="info" size="26px"></app-svg-icon>
          <div class="flex flex-col gap-2">
            <p class="h-full text-pretty w-full">
              Para modificar otros datos de tu cuenta como el DNI o el correo electrónico,
              contactate con las sucursales activas o envianos un correo a: <strong class="font-medium">{{ email }}</strong>
            </p>
            <p class="h-full text-pretty w-full">
              La información de tus turnos ya registrados no se actualizará por los cambios que hagas en esta sección.
              <strong class="font-medium">La modificación de datos recién tomará efecto en tus próximos movimientos</strong>.
            </p>
          </div>
      </div>
  </div>
</form>